
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>FUNtoFEM model &#8212; FUNtoFEM .0 documentation</title>
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="FUNtoFEM driver" href="driver.html" />
    <link rel="prev" title="Welcome to FUNtoFEM’s Documentation" href="index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="driver.html" title="FUNtoFEM driver"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to FUNtoFEM’s Documentation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">FUNtoFEM .0 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">FUNtoFEM model</a><ul>
<li><a class="reference internal" href="#assembling-the-model">Assembling the model</a></li>
<li><a class="reference internal" href="#exchanging-the-model-data-with-an-optimizer">Exchanging the model data with an optimizer</a><ul>
<li><a class="reference internal" href="#design-variables">Design variables</a></li>
<li><a class="reference internal" href="#function-values">Function values</a></li>
<li><a class="reference internal" href="#gradients">Gradients</a></li>
<li><a class="reference internal" href="#funtofem-model-class">FUNtoFEM Model Class</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bodies-and-scenarios">Bodies and Scenarios</a><ul>
<li><a class="reference internal" href="#scenarios">Scenarios</a></li>
<li><a class="reference internal" href="#bodies">Bodies</a></li>
<li><a class="reference internal" href="#base-class">Base class</a></li>
<li><a class="reference internal" href="#massoudbody">MassoudBody</a></li>
<li><a class="reference internal" href="#variables">Variables</a></li>
<li><a class="reference internal" href="#functions">Functions</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Welcome to FUNtoFEM’s Documentation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="driver.html"
                        title="next chapter">FUNtoFEM driver</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="funtofem-model">
<h1>FUNtoFEM model<a class="headerlink" href="#funtofem-model" title="Permalink to this headline">¶</a></h1>
<p>The model classes are used to stored design and coupling data related to the aeroelastic problem.
The model is made up of <a class="reference internal" href="#bodies-and-scenarios">bodies and scenarios</a> .</p>
<div class="figure">
<img alt="_images/funtofem_model.png" src="_images/funtofem_model.png" />
</div>
<p>The bodies are the different bodies in the simulations, such as the blades of a rotor.
The scenarios are the different points of a multipoint optimization.</p>
<p>Methods on this page with <strong>[driver call]</strong> and <strong>[model call]</strong> are calls that the user does not make directly and can be ignored.</p>
<div class="section" id="assembling-the-model">
<h2>Assembling the model<a class="headerlink" href="#assembling-the-model" title="Permalink to this headline">¶</a></h2>
<p>A model is assembled using the <code class="xref py py-func docutils literal notranslate"><span class="pre">add_body()</span></code> and <code class="xref py py-func docutils literal notranslate"><span class="pre">add_scenario()</span></code> calls. See <a class="reference internal" href="#bodies-and-scenarios">bodies and scenarios</a> for details about their creation.</p>
<p>The bodies and scenarios are kept in lists in the same order that they are input.</p>
</div>
<div class="section" id="exchanging-the-model-data-with-an-optimizer">
<h2>Exchanging the model data with an optimizer<a class="headerlink" href="#exchanging-the-model-data-with-an-optimizer" title="Permalink to this headline">¶</a></h2>
<p>The model object provides a convenient way to exchange data with a python-based optimizer.</p>
<div class="section" id="design-variables">
<h3>Design variables<a class="headerlink" href="#design-variables" title="Permalink to this headline">¶</a></h3>
<p>The assembled model contains all the design variables information that an optimizer such as PyOpt needs.
A list of the active design for the entire model is returned by <code class="xref py py-func docutils literal notranslate"><span class="pre">get_variables()</span></code>.
The output list contains the <a class="reference internal" href="#module-variable" title="variable"><code class="xref py py-class docutils literal notranslate"><span class="pre">variable</span></code></a> type. Here is an example of passing the variable information from the model to a PyOpt optimizer:</p>
<p><strong>The variables are stored in the model as a dictionary.</strong>
<strong>They return in of ordered list of scenarios in the order they were added to the model, then the bodies in the order that they were added. Within each scenario and body, the order is alphabetical by variable type. Within each variable type, the variables are in the order added to the body/scenario.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyOpt</span> <span class="kn">import</span> <span class="n">Optimization</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">opt_prob</span> <span class="o">=</span> <span class="n">Optimization</span><span class="p">(</span><span class="s1">&#39;optimization&#39;</span><span class="p">,</span><span class="n">design_problem</span><span class="o">.</span><span class="n">eval_obj_con</span><span class="p">)</span>
<span class="n">variables</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_variables</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables</span><span class="p">):</span>
    <span class="n">opt_prob</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">value</span><span class="o">/</span><span class="n">var</span><span class="o">.</span><span class="n">scaling</span><span class="p">,</span>
                                      <span class="n">lower</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">lower</span><span class="o">/</span><span class="n">var</span><span class="o">.</span><span class="n">scaling</span><span class="p">,</span>
                                      <span class="n">upper</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">upper</span><span class="o">/</span><span class="n">var</span><span class="o">.</span><span class="n">scaling</span><span class="p">)</span>
</pre></div>
</div>
<p>Optimizers such as PyOpt will typically provide a list of new values at each design point. These can be set back into model type using <code class="xref py py-func docutils literal notranslate"><span class="pre">set_variables()</span></code>.
The variables can be pre-scaled and passed directing into this call, or with the scale argument set to True, the scaling will be done automatically.</p>
</div>
<div class="section" id="function-values">
<h3>Function values<a class="headerlink" href="#function-values" title="Permalink to this headline">¶</a></h3>
<p>Once the driver has been run, <a class="reference internal" href="driver.html#funtofem_driver.FUNtoFEMDriver.solve_forward" title="funtofem_driver.FUNtoFEMDriver.solve_forward"><code class="xref py py-func docutils literal notranslate"><span class="pre">solve_forward()</span></code></a>, the functions can be retrieved using <code class="xref py py-func docutils literal notranslate"><span class="pre">get_functions()</span></code>.
The output list contains the <a class="reference internal" href="#module-function" title="function"><code class="xref py py-class docutils literal notranslate"><span class="pre">function</span></code></a> type. The following code prints the function values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">driver</span><span class="o">.</span><span class="n">solve_forward</span><span class="p">()</span>
<span class="n">functions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_functions</span><span class="p">()</span>

<span class="nb">print</span> <span class="s2">&quot;Function values:&quot;</span>
<span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables</span><span class="p">):</span>
    <span class="nb">print</span> <span class="n">function</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">function</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
<p>The functions in the FUNtoFEM model need to be single discipline functions to maintain modularity. The following pseudo code lays out a function that can be used as an objective evaluation with PyObj:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">eval_obj_con</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">fail</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">model</span><span class="o">.</span><span class="n">set_variables</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fail</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">solve_forward</span><span class="p">()</span>
    <span class="n">functions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_functions</span><span class="p">()</span>

    <span class="c1"># Manipulate/scale/combine single discipline functions</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">XXXXX</span>
    <span class="n">con</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">YYYYY</span>

    <span class="k">return</span> <span class="n">obj</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">fail</span>
</pre></div>
</div>
</div>
<div class="section" id="gradients">
<h3>Gradients<a class="headerlink" href="#gradients" title="Permalink to this headline">¶</a></h3>
<p>The derivatives in the model class are populated by <a class="reference internal" href="driver.html#funtofem_driver.FUNtoFEMDriver.solve_adjoint" title="funtofem_driver.FUNtoFEMDriver.solve_adjoint"><code class="xref py py-func docutils literal notranslate"><span class="pre">solve_adjoint()</span></code></a>. Gradients can be retrieved using <code class="xref py py-func docutils literal notranslate"><span class="pre">get_function_gradients()</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">variables</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_variables</span><span class="p">()</span>

<span class="n">driver</span><span class="o">.</span><span class="n">solve_forward</span><span class="p">()</span>
<span class="n">functions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_functions</span><span class="p">()</span>

<span class="n">fail</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">solve_adjoint</span><span class="p">()</span>
<span class="n">grad</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_functions_gradients</span><span class="p">()</span>
<span class="k">for</span> <span class="n">ifunc</span><span class="p">,</span><span class="n">func</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">functions</span><span class="p">):</span>
           <span class="k">for</span> <span class="n">ivar</span><span class="p">,</span><span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables</span><span class="p">):</span>
               <span class="nb">print</span> <span class="s1">&#39;Derivative of &#39;</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;w.r.t.&#39;</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">grad</span><span class="p">[</span><span class="n">ifunc</span><span class="p">][</span><span class="n">ivar</span><span class="p">]</span>
</pre></div>
</div>
<p>The following is a pseudo code would be a gradient evaluation for pyOpt.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">eval_obj_con_grad</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="n">con</span><span class="p">)</span>

    <span class="n">fail</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># get the scaling values</span>
    <span class="n">variables</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_variables</span><span class="p">()</span>
    <span class="n">var_scale</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
        <span class="n">var_scaling</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">scale</span><span class="p">)</span>

    <span class="c1"># solve the adjoint problem</span>
    <span class="n">fail</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">solve_adjoint</span><span class="p">()</span>
    <span class="n">grad</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_functions_gradients</span><span class="p">()</span>

    <span class="c1"># use the chain / automatic differentiation to get the composite function derivatives</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">dobj</span><span class="o">/</span><span class="n">dfunc0</span> <span class="o">*</span> <span class="n">grad</span><span class="p">[</span><span class="mi">0</span><span class="p">][:]</span> <span class="o">*</span><span class="n">variable_scaling</span> <span class="o">+</span> <span class="n">dobj</span><span class="o">/</span><span class="n">dfunc1</span> <span class="o">*</span> <span class="n">grad</span><span class="p">[</span><span class="mi">1</span><span class="p">][:]</span> <span class="o">*</span> <span class="n">variable_scaling</span> <span class="o">+</span> <span class="o">...</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">YYYYY</span>

    <span class="k">return</span> <span class="n">g</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">fail</span>
</pre></div>
</div>
</div>
<div class="section" id="funtofem-model-class">
<h3>FUNtoFEM Model Class<a class="headerlink" href="#funtofem-model-class" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="bodies-and-scenarios">
<h2>Bodies and Scenarios<a class="headerlink" href="#bodies-and-scenarios" title="Permalink to this headline">¶</a></h2>
<p>Bodies and scenarios organize the data associated for the coupling and design.
Additionally, the body class holds the shape parameterization and transfer scheme.
Shape parameterization is added by creating a new body class that subclasses the <code class="xref py py-class docutils literal notranslate"><span class="pre">body</span></code> class. See <code class="xref py py-class docutils literal notranslate"><span class="pre">MassoudBody</span></code> for an example.
The driver adds the details for the transfer scheme. See <a class="reference internal" href="driver.html#funtofem_driver.FUNtoFEMDriver" title="funtofem_driver.FUNtoFEMDriver"><code class="xref py py-class docutils literal notranslate"><span class="pre">FUNtoFEMDriver</span></code></a>.</p>
<div class="section" id="scenarios">
<h3>Scenarios<a class="headerlink" href="#scenarios" title="Permalink to this headline">¶</a></h3>
<p>Scenarios hold <a class="reference internal" href="#variables">variables</a> and <a class="reference internal" href="#functions">functions</a> in lists.
Variables and functions are added using <code class="xref py py-func docutils literal notranslate"><span class="pre">add_function()</span></code> and <code class="xref py py-func docutils literal notranslate"><span class="pre">add_variable()</span></code>.</p>
<p>An example of a scenario variable could be flow variables such as angle of attack or Mach number.</p>
<div class="figure">
<img alt="_images/scenario.png" src="_images/scenario.png" />
</div>
</div>
<div class="section" id="bodies">
<h3>Bodies<a class="headerlink" href="#bodies" title="Permalink to this headline">¶</a></h3>
<p>Shape parameterization is added by creating a new body class that subclasses the <code class="xref py py-class docutils literal notranslate"><span class="pre">body</span></code> class. See <code class="xref py py-class docutils literal notranslate"><span class="pre">MassoudBody</span></code> for an example.
The driver adds the details for the transfer scheme. See <a class="reference internal" href="driver.html#funtofem_driver.FUNtoFEMDriver" title="funtofem_driver.FUNtoFEMDriver"><code class="xref py py-class docutils literal notranslate"><span class="pre">FUNtoFEMDriver</span></code></a>.</p>
<div class="figure">
<img alt="_images/body.png" src="_images/body.png" />
</div>
</div>
<div class="section" id="base-class">
<h3>Base class<a class="headerlink" href="#base-class" title="Permalink to this headline">¶</a></h3>
<p>The body and scenario classes subclass the <a class="reference internal" href="#base-class">base class</a>.</p>
<p>Although most of the methods in the base class are used internally in the model, <a class="reference internal" href="#base.Base.set_variable" title="base.Base.set_variable"><code class="xref py py-func docutils literal notranslate"><span class="pre">set_variable()</span></code></a> allows the user to change attributes of existing <a class="reference internal" href="#variables">variables</a> in the body or scenario.
For example, if the shape parameterization created a specific number of variables, but you do not want to use all of them in the optimization, you can set the variable to be inactive.</p>
<span class="target" id="module-base"></span><dl class="class">
<dt id="base.Base">
<em class="property">class </em><code class="descclassname">base.</code><code class="descname">Base</code><span class="sig-paren">(</span><em>name</em>, <em>id=0</em>, <em>group=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/base.html#Base"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#base.Base" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for FUNtoFEM bodies and scenarios</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – name of the body or scenario</li>
<li><strong>id</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – id number in list of bodies or scenarios in the model</li>
<li><strong>group</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – group number for the body or scenario. Coupled variables defined in the body/scenario will be coupled with
bodies/scenarios in the same group</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><code class="xref py py-mod docutils literal notranslate"><span class="pre">body</span></code>, <code class="xref py py-mod docutils literal notranslate"><span class="pre">scenario</span></code></p>
</div>
<dl class="method">
<dt id="base.Base.add_variable">
<code class="descname">add_variable</code><span class="sig-paren">(</span><em>vartype</em>, <em>var</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/base.html#Base.add_variable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#base.Base.add_variable" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a new variable to the body’s or scenario’s variable dictionary</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>vartype</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – type of variable</li>
<li><strong>var</strong> (<em>Variable object</em>) – variable to be added</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="base.Base.set_variable">
<code class="descname">set_variable</code><span class="sig-paren">(</span><em>vartype</em>, <em>name=None</em>, <em>index=None</em>, <em>value=None</em>, <em>lower=None</em>, <em>upper=None</em>, <em>scaling=None</em>, <em>active=True</em>, <em>coupled=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/base.html#Base.set_variable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#base.Base.set_variable" title="Permalink to this definition">¶</a></dt>
<dd><p>Set one or more properties of a variable given the vartype and either the variable name or a list of id’s</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>vartype</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – type of variable</li>
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – name of the variable</li>
<li><strong>index</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em> or </em><em>list of ints</em>) – list of id numbers for the variables to modify</li>
<li><strong>value</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#complex" title="(in Python v3.9)"><em>complex</em></a>) – value of the variable</li>
<li><strong>lower</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – lower bound for the variable</li>
<li><strong>upper</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – upper bound for the variable</li>
<li><strong>scaling</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – scaling of the variable for an optimizer</li>
<li><strong>active</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – whether or not the variable is active</li>
<li><strong>coupled</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – whether or not the variable is coupled</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p>base.set_variable(‘aerodynamic’,name=’AOA’,value=3.0)</p>
<p>base.set_variable(‘structural’,index=2,active=False)</p>
<p>base.set_variable(‘structural’,index=[0,1,2,3,4],active=False)</p>
</dd></dl>

<dl class="method">
<dt id="base.Base.count_active_variables">
<code class="descname">count_active_variables</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/base.html#Base.count_active_variables"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#base.Base.count_active_variables" title="Permalink to this definition">¶</a></dt>
<dd><p>Counts the number of active variables in this body or scenario</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><strong>count</strong> – number of active variables in the variable dictionary</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="base.Base.count_uncoupled_variables">
<code class="descname">count_uncoupled_variables</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/base.html#Base.count_uncoupled_variables"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#base.Base.count_uncoupled_variables" title="Permalink to this definition">¶</a></dt>
<dd><p>Counts the number of variables in this body or scenario that are both uncoupled and active
This is the number of unique variables to this object</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><strong>count</strong> – number of uncoupled, active variables in the variable dictionary</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="base.Base.active_variables">
<code class="descname">active_variables</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/base.html#Base.active_variables"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#base.Base.active_variables" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the list of active variables in body or scenario</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><strong>active_list</strong> – list of active variables</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">list of variables</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="base.Base.uncoupled_variables">
<code class="descname">uncoupled_variables</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/base.html#Base.uncoupled_variables"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#base.Base.uncoupled_variables" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the list of uncoupled, active variables in body or scenario</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><strong>active_list</strong> – list of uncoupled, active variables</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">list of variables</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="base.Base.couple_variables">
<code class="descname">couple_variables</code><span class="sig-paren">(</span><em>base</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/base.html#Base.couple_variables"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#base.Base.couple_variables" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>[model call]</strong>
Updates coupled variables in the body or scenario based on the input’s variables</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>base</strong> (<em>body</em><em> or </em><em>scenario object</em>) – body or scenario to copy coupled variables from</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="base.Base.update_id">
<code class="descname">update_id</code><span class="sig-paren">(</span><em>id</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/base.html#Base.update_id"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#base.Base.update_id" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>[model call]</strong>
Update the id number of the body or scenario</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>id</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – id number of the scenario</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="base.Base.add_coupled_derivatives">
<code class="descname">add_coupled_derivatives</code><span class="sig-paren">(</span><em>base</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/base.html#Base.add_coupled_derivatives"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#base.Base.add_coupled_derivatives" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>[model call]</strong>
Adds coupled derivatives in the body or scenario based on the input’s derivatives</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>base</strong> (<em>body</em><em> or </em><em>scenario object</em>) – body or scenario to copy coupled variables from</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="base.Base.set_coupled_derivatives">
<code class="descname">set_coupled_derivatives</code><span class="sig-paren">(</span><em>base</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/base.html#Base.set_coupled_derivatives"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#base.Base.set_coupled_derivatives" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>[model call]</strong>
Updates coupled derivatives in the body or scenario based on the input’s derivatives</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>base</strong> (<em>body</em><em> or </em><em>scenario object</em>) – body or scenario to copy coupled variables from</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="base.Base.add_function_derivatives">
<code class="descname">add_function_derivatives</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/base.html#Base.add_function_derivatives"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#base.Base.add_function_derivatives" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>[model call]</strong>
For each variable, add a new derivative value for a single new function</p>
</dd></dl>

<dl class="method">
<dt id="base.Base.active_derivatives">
<code class="descname">active_derivatives</code><span class="sig-paren">(</span><em>n</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/base.html#Base.active_derivatives"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#base.Base.active_derivatives" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>[model call]</strong>
Get the derivatives of a function, n, with respect to all the active variables in this body or scenario</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>n</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – the function number</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><strong>active_list</strong> – list of derivative values for each active variable in this object</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">list of float</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="base.Base.uncoupled_derivatives">
<code class="descname">uncoupled_derivatives</code><span class="sig-paren">(</span><em>n</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/base.html#Base.uncoupled_derivatives"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#base.Base.uncoupled_derivatives" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>[model call]</strong>
Get the derivatives of a function, n, with respect to all the uncoupled, active variables in this body or scenario</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>n</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – the function number</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><strong>active_list</strong> – list of derivative values for each uncoupled, active variable in this object</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">list of float</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="massoudbody">
<h3>MassoudBody<a class="headerlink" href="#massoudbody" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="variables">
<h3>Variables<a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h3>
<p>Some solvers like FUN3D require some design variables to be defined, whether or not it is being used in design.
The active attribute of the <a class="reference internal" href="#variable.Variable" title="variable.Variable"><code class="xref py py-class docutils literal notranslate"><span class="pre">Variable</span></code></a> class. Setting it to False, allows you to still define the variable but it won’t be returned when calling <code class="xref py py-func docutils literal notranslate"><span class="pre">get_variables()</span></code>.
When the variable is added to a <code class="xref py py-class docutils literal notranslate"><span class="pre">Scenario</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">Body</span></code> using <a class="reference internal" href="#base.Base.add_variable" title="base.Base.add_variable"><code class="xref py py-func docutils literal notranslate"><span class="pre">add_variable()</span></code></a>, the vartype argument specifies what discipline the variable is associated with.</p>
<span class="target" id="module-variable"></span><dl class="class">
<dt id="variable.Variable">
<em class="property">class </em><code class="descclassname">variable.</code><code class="descname">Variable</code><span class="sig-paren">(</span><em>name='unknown'</em>, <em>value=0.0</em>, <em>lower=0.0</em>, <em>upper=1.0</em>, <em>scaling=1.0</em>, <em>active=True</em>, <em>coupled=False</em>, <em>id=0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/variable.html#Variable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#variable.Variable" title="Permalink to this definition">¶</a></dt>
<dd><p>Design variable type for FUNtoFEM</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – name of the variable</li>
<li><strong>value</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – current value of the variable</li>
<li><strong>lower</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – lower bound of the design variable</li>
<li><strong>upper</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – upper bound of the design variable</li>
<li><strong>scaling</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – scaling of the variable for an optimizer</li>
<li><strong>active</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – whether or not the design variable is active</li>
<li><strong>coupled</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – whether or not the design variable is coupled</li>
<li><strong>id</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – id number of the design variable</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p>thickness = Variable(name=’thickness 0’, value = 0.004, lower = 0.001, upper 0.1)</p>
<dl class="method">
<dt id="variable.Variable.assign">
<code class="descname">assign</code><span class="sig-paren">(</span><em>value=None</em>, <em>lower=None</em>, <em>upper=None</em>, <em>scaling=None</em>, <em>active=None</em>, <em>coupled=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/variable.html#Variable.assign"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#variable.Variable.assign" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the one or more of the attributes of the design variable</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>value</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – new value of the variable</li>
<li><strong>lower</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – lower bound of the design variable</li>
<li><strong>upper</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – upper bound of the design variable</li>
<li><strong>scaling</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – scaling of the variable for an optimizer</li>
<li><strong>active</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – whether or not the design variable is active</li>
<li><strong>coupled</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – whether or not the design variable is coupled</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h3>
<p>Functions in the FUNtoFEM framework are single discipline functions.
The <em>analysis_type</em> argument specifics which discipline the function is associated with.
Currently the options are ‘aerodynamic’ and ‘structural’.</p>
<p>Once the function is instantiated, <code class="xref py py-class docutils literal notranslate"><span class="pre">add_function</span></code> is used to add it to a scenario.
Although the function values could be accessed from the model type, <code class="xref py py-func docutils literal notranslate"><span class="pre">get_functions()</span></code> will return all the <a class="reference internal" href="#functions">functions</a> defined in the model.</p>
<p>When FUNtoFEM is used with FUN3D, the name of any function that would be defined in the rubber.data can be used.
For functions that do not need an adjoint, such as structural mass, the boolean, adjoint, should be set to false.
Some functions are associated with particular bodies, for instance, if you wanted the thrust or torque of a rotor without including that of the sting model, you can use the body argument to pass that information to the solver.</p>
<span class="target" id="module-function"></span><dl class="class">
<dt id="function.Function">
<em class="property">class </em><code class="descclassname">function.</code><code class="descname">Function</code><span class="sig-paren">(</span><em>name</em>, <em>id=0</em>, <em>value=0.0</em>, <em>start=0</em>, <em>stop=-1</em>, <em>analysis_type=None</em>, <em>body=-1</em>, <em>adjoint=True</em>, <em>options=None</em>, <em>averaging=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/function.html#Function"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#function.Function" title="Permalink to this definition">¶</a></dt>
<dd><p>holds component function information in FUNtoFEM</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – name of the function</li>
<li><strong>id</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – id number of function</li>
<li><strong>value</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – value of the function</li>
<li><strong>start</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – time step that the function window starts. If steady, then ignore</li>
<li><strong>stop</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – time step that the function window ends. If steady, set to -1 (the default)</li>
<li><strong>analysis_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – type of analysis this function is associated with: ‘aerodynamic’,’structural’</li>
<li><strong>body</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – body number that the function is associated with. The default is 0 which is all bodies</li>
<li><strong>adjoint</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – whether or not an adjoint is required for a function</li>
<li><strong>options</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – any options associated with the function and pass to the solvers</li>
<li><strong>averaging</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – whether the function is averaged or integrated or the function window. Ignored for steady functions</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p>lift = Function(‘lift’,analysis_type=’aerodynamic’)</p>
<p>mass = Function(‘mass’,analysis_type=’structural’,adjoint=False)</p>
<p>ks = Function(‘ksFailure’,analysis_type=’structural’,options={‘ksweight’:50.0})</p>
</dd></dl>

</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="driver.html" title="FUNtoFEM driver"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to FUNtoFEM’s Documentation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">FUNtoFEM .0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, FUNtoFEM Developers.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>